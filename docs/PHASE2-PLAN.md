# План разработки: Фаза 2

Этот документ содержит детальный план второй фазы разработки aprover.

## Обзор Фазы 2

Фаза 2 направлена на улучшение пользовательского интерфейса и расширение функциональности прувера.

## Этап 2.1: Компонентная архитектура UI

- [x] Создать компонент `Editor.vue` — редактор кода с базовой подсветкой синтаксиса
- [x] Создать компонент `ASTViewer.vue` — визуализация AST в виде дерева
- [x] Создать компонент `ProverPanel.vue` — панель с результатами проверки
- [x] Создать компонент `ErrorPanel.vue` — панель отображения ошибок
- [x] Рефакторинг `App.vue` для использования новых компонентов

**Критерии успеха:**
- ✅ Модульная архитектура с четким разделением ответственности
- ✅ Переиспользуемые компоненты
- ✅ Все E2E тесты проходят (19 тестов: 17 обновлённых + 2 новых для AST viewer)

## Этап 2.2: Подсветка синтаксиса

- [x] Реализовать подсветку ключевых слов и операторов МТС
- [x] Цветовая схема для разных типов токенов:
  - Операторы: `->`, `!->`, `:`, `=`, `!=`
  - Символы: `∞`, `♂`, `♀`, `!`
  - Идентификаторы
  - Числа: `0`, `1`
  - Комментарии: `//`

**Критерии успеха:**
- ✅ Подсветка синтаксиса в реальном времени
- ✅ Корректная обработка многострочного ввода

## Этап 2.3: Визуализация AST

- [x] Древовидное представление AST
- [x] Интерактивное сворачивание/разворачивание узлов
- [x] Подсветка соответствия между исходным кодом и узлами AST
- [x] Кнопки "Expand All" / "Collapse All" для управления деревом
- [x] Отображение позиции узла в исходном коде `[line:column]`
- [x] E2E тесты для новых функций AST визуализации (7 новых тестов)

**Критерии успеха:**
- ✅ Наглядное отображение структуры выражений
- ✅ Быстрый отклик при изменении кода
- ✅ Интерактивная подсветка исходного кода при наведении на узлы AST

## Этап 2.4: Улучшение прувера

- [x] Пошаговый вывод доказательства (step-by-step)
- [x] Отображение применённых аксиом
- [x] Подсказки при неудачной верификации

**Критерии успеха:**
- ✅ Понятный пользователю процесс верификации
- ✅ Информативные сообщения об ошибках

## Этап 2.5: Тестирование и документация

- [x] Unit-тесты для новых компонентов
- [x] Обновление E2E тестов
- [x] Документация по компонентам

**Критерии успеха:**
- ✅ Покрытие тестами новых компонентов
- ✅ Все существующие тесты проходят

---

## Ход работ

### 2026-02-13: Начало Фазы 2

**Этап 2.1: Компонентная архитектура UI** — Завершено
- Создан план второй фазы разработки
- Реализованы четыре Vue компонента:
  - `Editor.vue` — редактор с подсветкой синтаксиса (комментарии, операторы, символы)
  - `ASTViewer.vue` — интерактивная визуализация AST с возможностью сворачивания узлов
  - `ProverPanel.vue` — панель результатов с отображением шагов доказательства
  - `ErrorPanel.vue` — панель ошибок парсинга
- Обновлён `App.vue` с модульной архитектурой и переключателем AST панели
- Добавлена статистика верификации в footer

**Этап 2.2: Подсветка синтаксиса** — Завершено
- Реализован токен-ориентированный механизм подсветки синтаксиса
- Цветовая схема для всех типов токенов МТС:
  - Комментарии (серый курсив): `// ...`
  - Операторы связи (розовый): `->`, `!->`
  - Символ бесконечности (золотой): `∞`
  - Мужской символ (синий): `♂`
  - Женский символ (розовый): `♀`
  - Оператор отрицания (красный): `!`, `¬`
  - Оператор степени (фиолетовый): `^`
  - Знаки равенства (зелёный): `=`, `!=`, `≠`
  - Определение (синий): `:`
  - Скобки (жёлтый/розовый/синий): `()`, `{}`, `[]`
  - Числа (фиолетовый): `0`, `1`
  - Идентификаторы (светло-серый): переменные
- Корректная обработка многострочного ввода с учётом комментариев

**Этап 2.3: Визуализация AST** — Завершено
- Улучшена визуализация AST с расширенной интерактивностью:
  - Кнопки "Expand All" / "Collapse All" для быстрого управления деревом
  - Отображение позиции узла в исходном коде `[line:column]`
  - Подсветка соответствующего исходного кода при наведении на узлы AST
  - Tooltips с информацией о позиции узла
- Рефакторинг логики авто-расширения для корректной работы с ручным управлением
- Добавлены 7 новых E2E тестов для функций AST визуализации
- **Итого E2E тестов:** 26 (19 + 7 новых)
- **Итого всех тестов:** 160 (134 unit/интеграционных + 26 E2E)

**Этап 2.4: Улучшение прувера** — Завершено
- Реализован пошаговый вывод доказательства с детальной информацией:
  - Номер шага и действие
  - Выражения до и после преобразования
  - Примененная аксиома с подсказкой
  - Дополнительные детали о шаге
- Добавлено отображение применённых аксиом:
  - Цветные бейджи с идентификаторами аксиом (A0-A11)
  - Всплывающие подсказки с названием и формулой аксиомы
  - Константа `AXIOMS` с полной информацией о всех аксиомах МТС v0.1
- Добавлены подсказки при неудачной верификации:
  - Анализ типа ошибки (структурная, определение, аксиома, предложение)
  - Ссылки на связанные аксиомы
  - Информативные сообщения о возможных причинах
- Интерактивный интерфейс:
  - Раскрывающиеся панели с деталями доказательства
  - Секция подсказок для неудачных верификаций
- Добавлены 18 новых unit-тестов для функций прувера
- Добавлены 15 новых E2E тестов для UI прувера
- **Итого E2E тестов:** 41 (26 + 15 новых)
- **Итого всех тестов:** 193 (152 unit/интеграционных + 41 E2E)

---

## Связь с Фазой 1

Фаза 2 строится на основе полностью завершённой Фазы 1:
- ✅ Лексер формальной нотации
- ✅ Парсер формальной нотации
- ✅ Нормализатор
- ✅ Ядро прувера
- ✅ Базовый веб-интерфейс
- ✅ 151 тест (104 unit + 33 интеграционных + 17 E2E)

---

## Фаза 2: Завершена

Все этапы второй фазы разработки успешно выполнены:
- ✅ Этап 2.1: Компонентная архитектура UI
- ✅ Этап 2.2: Подсветка синтаксиса
- ✅ Этап 2.3: Визуализация AST
- ✅ Этап 2.4: Улучшение прувера
- ✅ Этап 2.5: Тестирование и документация
